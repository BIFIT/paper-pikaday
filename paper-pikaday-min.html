<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="./styles.html">

<script src="../vanilla-masker/build/vanilla-masker.min.js"></script>
<script>"use strict";!function(e,t,n){var a="Минуты",i="Часы",s=function(e,t,n,a){e.addEventListener(t,n,!!a)},o=function(e,t,n,a){e.removeEventListener(t,n,!!a)},r=function(e,n,a){var i;t.createEvent?(i=t.createEvent("HTMLEvents"),i.initEvent(n,!0,!1),i=y(i,a),e.dispatchEvent(i)):t.createEventObject&&(i=t.createEventObject(),i=y(i,a),e.fireEvent("on"+n,i))},l=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},u=function(e,t){return-1!==(" "+e.className+" ").indexOf(" "+t+" ")},d=function(e,t){u(e,t)||(e.className=""===e.className?t:e.className+" "+t)},h=function(e,t){e.className=l((" "+e.className+" ").replace(" "+t+" "," "))},c=function(e){return/Array/.test(Object.prototype.toString.call(e))},f=function(e){return/Date/.test(Object.prototype.toString.call(e))&&!isNaN(e.getTime())},p=function(e){var t=e.getDay();return 0===t||6===t},g=function(e){return e%4===0&&e%100!==0||e%400===0},m=function(e,t){return[31,g(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},v=function(e,t){return e.getTime()===t.getTime()},y=function(e,t,n){var a,i;for(a in t)i=void 0!==e[a],i&&"object"===$traceurRuntime["typeof"](t[a])&&null!==t[a]&&void 0===t[a].nodeName?f(t[a])?n&&(e[a]=new Date(t[a].getTime())):c(t[a])?n&&(e[a]=t[a].slice(0)):e[a]=y({},t[a],n):(n||!i)&&(e[a]=t[a]);return e},D=function(e){return e.month<0&&(e.year-=Math.ceil(Math.abs(e.month)/12),e.month+=12),e.month>11&&(e.year+=Math.floor(Math.abs(e.month)/12),e.month-=12),e},b={field:null,bound:void 0,position:"bottom left",reposition:!0,format:"YYYY-MM-DD",defaultDate:null,setDefaultDate:!1,firstDay:0,minDate:null,maxDate:null,yearRange:10,showWeekNumber:!1,minYear:0,maxYear:9999,minMonth:void 0,maxMonth:void 0,startRange:null,endRange:null,isRTL:!1,yearSuffix:"",showMonthAfterYear:!1,numberOfMonths:1,mainCalendar:"left",container:void 0,i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],weekdays:["Воскресение","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],weekdaysShort:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"]},onSelect:null,onOpen:null,onClose:null,onDraw:null},_=function(e,t,n){for(t+=e.firstDay;t>=7;)t-=7;return n?e.i18n.weekdaysShort[t]:e.i18n.weekdays[t]},w=function(e){if(e.isEmpty)return'<td class="is-empty"></td>';var t='<button type="button" class="pika-button pika-day" ',n=[];return e.isDisabled&&(n.push("is-disabled"),t+=" disabled "),e.isToday&&n.push("is-today"),e.isSelected&&(n.push("is-selected"),t+=" active "),e.isInRange&&n.push("is-inrange"),e.isStartRange&&n.push("is-startrange"),e.isEndRange&&n.push("is-endrange"),t+='data-pika-year="'+e.year+'" data-pika-month="'+e.month+'" data-pika-day="'+e.day+'">'+e.day+"</button>",'<td data-day="'+e.day+'" class="'+n.join(" ")+'">'+t+"</td>"},M=function(e,t,n){var a=new Date(n,0,1),i=Math.ceil(((new Date(n,t,e)-a)/864e5+a.getDay()+1)/7);return'<td class="pika-week">'+i+"</td>"},k=function(e,t){return"<tr>"+(t?e.reverse():e).join("")+"</tr>"},R=function(e){return"<tbody>"+e.join("")+"</tbody>"},x=function(e){var t=[];e.showWeekNumber&&t.push("<th></th>");for(var n=0;7>n;n++)t.push('<th scope="col"><abbr title="'+_(e,n)+'">'+_(e,n,!0)+"</abbr></th>");return"<thead>"+(e.isRTL?t.reverse():t).join("")+"</thead>"},N=function(e,t){var a="";a+='<span class="drop-menu"><p>Часы</p>',a+='<paper-dropdown-menu label="'+i+'" no-animations no-label-float>',a+='<paper-menu class="dropdown-content">';for(var s=0;24>s;s+=2){var o=10>s?"0"+s:s;a+="<paper-item>"+o+"</paper-item>"}return a+="</paper-menu></paper-dropdown-menu></span>",n(function(){Y.bind(e)(t)},0),a},C=function(e,t){var i="";i+='<span class="drop-menu"><p>Минуты</p>',i+='<paper-dropdown-menu label="'+a+'" no-animations no-label-float>',i+='<paper-menu class="dropdown-content">';for(var s=0;60>s;s+=5){var o=10>s?"0"+s:s;i+="<paper-item>"+o+"</paper-item>"}return i+="</paper-menu></paper-dropdown-menu></span>",n(function(){S.bind(e)(t)},0),i},T=function(e,t,n,a,i){var s,o,r,l,u,d=e._o,h=n===d.minYear,f=n===d.maxYear,p='<div class="pika-title">',g=!0,m=!0;for(r=[],s=0;12>s;s++)r.push('<option value="'+(n===i?s-t:12+s-t)+'"'+(s===a?" selected":"")+(h&&s<d.minMonth||f&&s>d.maxMonth?"disabled":"")+">"+d.i18n.months[s]+"</option>");for(l='<div class="pika-label">'+d.i18n.months[a]+'<select class="pika-select pika-select-month" tabindex="-1">'+r.join("")+"</select></div>",c(d.yearRange)?(s=d.yearRange[0],o=d.yearRange[1]+1):(s=n-d.yearRange,o=1+n+d.yearRange),r=[];o>s&&s<=d.maxYear;s++)s>=d.minYear&&r.push('<option value="'+s+'"'+(s===n?" selected":"")+">"+s+"</option>");if(u='<div class="pika-label">'+n+d.yearSuffix+'<select class="pika-select pika-select-year" tabindex="-1">'+r.join("")+"</select></div>",p+=d.showMonthAfterYear?u+l:l+u,h&&(0===a||d.minMonth>=a)&&(g=!1),f&&(11===a||d.maxMonth<=a)&&(m=!1),0===t){var v='<button type="button" ';v+='class="pika-prev ',g?v+='"':(v+=' is-disabled"',v+=" disabled "),v+=">"+d.i18n.previousMonth,v+="</button>",p+=v}if(t===e._o.numberOfMonths-1){var y='<button type="button"';y+=' class="pika-next ',m?y+='"':(y+=' is-disabled"',y+=" disabled "),y+=">"+d.i18n.nextMonth,y+="</button>",p+=y}return p+="</div>"},E=function(e,t){return'<table cellpadding="0" cellspacing="0" class="pika-table">'+x(e)+R(t)+"</table>"},S=function(e){j.bind(this.el)().value=e},I=function(){return Number.parseInt(j.bind(this)().value||0)},Y=function(e){A.bind(this.el)().value=e},F=function(){return Number.parseInt(A.bind(this)().value||0)},j=function(){return this.querySelector('[label="'+a+'"] paper-input')},A=function(){return this.querySelector('[label="'+i+'"] paper-input')},O=function(e){var t;try{t=e.querySelectorAll("paper-dropdown-menu")}catch(n){return!1}for(var a=0;a<t.length;a++){var n=t[a];n.opened&&n.close()}},L=function(e,t,n){var a,i,s,o,r;if("PAPER-MATERIAL"===e.tagName){if(a=F.bind(e)(),i=I.bind(e)(),n&&n.calendars){var l=n.calendars[0];s=l.year,o=l.month,r=l.day}}else if(e.el){a=F.bind(e.el)(),i=I.bind(e.el)(),s=e.calendars&&e.calendars[0].year,o=e.calendars&&e.calendars[0].month,r=1;try{r=n.getDate&&n.getDate().getDate()}catch(u){console.warn("date is not select, default by 1")}}return t&&(r=t.getAttribute("data-pika-day"),o=t.getAttribute("data-pika-month"),s=t.getAttribute("data-pika-year")),new Date(s,o,r,a,i)},B=function(n){var o=this,r=o.config(n);o._onMouseDown=function(t){if(o._v){t=t||e.event;var n=t.target||t.srcElement;if(n){switch(n.tagName){case"PAPER-MATERIAL":return;case"PAPER-ITEM":var s=L(this,null,o),r=n.closest("[label]").getAttribute("label"),l=String(n.textContent);return i===r?(s.setHours(l),o.calendars[0].hour=l):a===r&&(s.setMinutes(l),o.calendars[0].minute=l),o._d=s,void o.setFieldFormat()}if(n.getAttribute("data-pika-year")&&(o._d=L(this,n)),!u(n.parentNode,"is-disabled")){var d=n.closest(".pika-button");if(d&&!d.classList.contains("is-empty")){var h=L(this,d);return void o.setDate(h)}u(n,"pika-prev")?o.prevMonth():u(n,"pika-next")&&o.nextMonth()}if(u(n,"pika-select"))o._c=!0;else{if(O(this),!t.preventDefault)return t.returnValue=!1,t.returnValue;t.preventDefault()}}}},o._onChange=function(t){t=t||e.event;var n=t.target||t.srcElement;n&&(u(n,"pika-select-month")?o.gotoMonth(n.value):u(n,"pika-select-year")&&o.gotoYear(n.value))},o._onInputChange=function(e){if(e.firedBy!==o){var t=new Date(Date.parse(r.field.value));f(t)&&o.setDate(t),o._v||o.show()}},o._onInputFocus=function(){o.show()},o._onInputClick=function(){o.show()},o._onInputBlur=function(){var e=t.activeElement;do if(u(e,"pika-single"))return;while(e=e.parentNode);o._c=!1},o._onClick=function(t){t=t||e.event;var n=t.target||t.srcElement,a=n;if(n){u(n,"pika-select")&&(n.onchange||(n.setAttribute("onchange","return;"),s(n,"change",o._onChange)));do if(u(a,"pika-single")||a===r.trigger)return;while(a=a.parentNode);o._v&&n!==r.trigger&&a!==r.trigger&&o.hide()}},o.el=t.createElement("paper-material"),o.el.elevation=2,o.el.style.backgroundColor="white",o.el.style.position="absolute",o.el.className="pika-single"+(r.isRTL?" is-rtl":""),s(o.el,"ontouchend"in t?"touchend":"mousedown",o._onMouseDown,!0),s(o.el,"change",o._onChange),s(r.field,"keyup",function(e){if(9===e.keyCode)return void o.hideElem(t.querySelector(".pika-single"));if(13===e.keyCode){var n=B.convertStringToDate(e.target.value);o.setDate(n)}}),r.field&&(r.container?r.container.appendChild(o.el):r.bound?t.body.appendChild(o.el):r.field.parentNode.insertBefore(o.el,r.field.nextSibling),s(r.field,"change",o._onInputChange),r.defaultDate||(r.defaultDate=new Date(Date.parse(r.field.value)),r.setDefaultDate=!0));var l=r.defaultDate;f(l)?r.setDefaultDate?o.setDate(l,!0):o.gotoDate(l):o.gotoDate(new Date),r.bound?(this.hide(),s(r.trigger,"click",o._onInputClick),s(r.trigger,"focus",o._onInputFocus),s(r.trigger,"blur",o._onInputBlur)):this.show()};return B.prototype={config:function(e){this._o||(this._o=y({},b,!0));var t=y(this._o,e,!0);t.isRTL=!!t.isRTL,t.field=t.field&&t.field.nodeName?t.field:null,t.bound=!!(void 0!==t.bound?t.field&&t.bound:t.field),t.trigger=t.trigger&&t.trigger.nodeName?t.trigger:t.field,t.disableWeekends=!!t.disableWeekends,t.disableDayFn="function"===$traceurRuntime["typeof"](t.disableDayFn)?t.disableDayFn:null;var n=parseInt(t.numberOfMonths,10)||1;if(t.numberOfMonths=n>4?4:n,f(t.minDate)||(t.minDate=!1),f(t.maxDate)||(t.maxDate=!1),t.minDate&&t.maxDate&&t.maxDate<t.minDate&&(t.maxDate=t.minDate=!1),t.minDate&&this.setMinDate(t.minDate),t.maxDate&&(t.maxYear=t.maxDate.getFullYear(),t.maxMonth=t.maxDate.getMonth()),c(t.yearRange)){var a=(new Date).getFullYear()-10;t.yearRange[0]=parseInt(t.yearRange[0],10)||a,t.yearRange[1]=parseInt(t.yearRange[1],10)||a}else t.yearRange=Math.abs(parseInt(t.yearRange,10))||b.yearRange,t.yearRange>100&&(t.yearRange=100);return t},toString:function(){return B.toFormatDate(this._d)},getDate:function(){return f(this._d)?new Date(this._d.getTime()):null},setDate:function(e,t){if(!e)return this._d=null,this._o.field&&(this._o.field.value="",r(this._o.field,"change",{firedBy:this})),this.draw();if("string"==typeof e&&(e=new Date(Date.parse(e))),f(e)){var n=this._o.minDate,a=this._o.maxDate;f(n)&&n>e?e=n:f(a)&&e>a&&(e=a),this._d=new Date(e.getTime()),this.gotoDate(this._d),this.setFieldFormat()}},setFieldFormat:function(){return null===this.getDate()?!1:(this._o.field&&(this._o.field.value=this.toString(),r(this._o.field,"change",{firedBy:this})),void("function"==typeof this._o.onSelect&&this._o.onSelect.call(this,this.getDate())))},gotoDate:function(e){var t=!0;if(f(e)){if(this.calendars){var n=new Date(this.calendars[0].year,this.calendars[0].month,1),a=new Date(this.calendars[this.calendars.length-1].year,this.calendars[this.calendars.length-1].month,1),i=e.getTime();a.setMonth(a.getMonth()+1),a.setDate(a.getDate()-1),t=i<n.getTime()||a.getTime()<i}this.calendars=[{day:e.getDate(),hour:e.getHours(),minute:e.getMinutes(),month:e.getMonth(),year:e.getFullYear()}],"right"===this._o.mainCalendar&&(this.calendars[0].month+=1-this._o.numberOfMonths),this.adjustCalendars()}},adjustCalendars:function(){this.calendars[0]=D(this.calendars[0]);for(var e=1;e<this._o.numberOfMonths;e++)this.calendars[e]=D({month:this.calendars[0].month+e,year:this.calendars[0].year});this.draw()},gotoToday:function(){this.gotoDate(new Date)},gotoMonth:function(e){isNaN(e)||(this.calendars[0].month=parseInt(e,10),this.adjustCalendars())},nextMonth:function(){this.calendars[0].month++,this.adjustCalendars()},prevMonth:function(){this.calendars[0].month--,this.adjustCalendars()},gotoYear:function(e){isNaN(e)||(this.calendars[0].year=parseInt(e,10),this.adjustCalendars())},setMinDate:function(e){this._o.minDate=e,this._o.minYear=e.getFullYear(),this._o.minMonth=e.getMonth()},setMaxDate:function(e){this._o.maxDate=e},setStartRange:function(e){this._o.startRange=e},setEndRange:function(e){this._o.endRange=e},nowButton:function(){var e=this,n=t.createElement("paper-icon-button");return n.icon="restore",n.title="Установить текущее время",n.className="nowBtn",n.onclick=function(){var t=new Date;e.setDate(t)},n},draw:function(e){if(this._v||e){var t=this._o,a=t.minYear,i=t.maxYear,s=t.minMonth,o=t.maxMonth,r="",l=this;this._y<=a&&(this._y=a,!isNaN(s)&&this._m<s&&(this._m=s)),this._y>=i&&(this._y=i,!isNaN(o)&&this._m>o&&(this._m=o));for(var u=0;u<t.numberOfMonths;u++){var d=this.calendars[u];r+='<div class="pika-lendar">'+T(this,u,d.year,d.month,this.calendars[0].year)+this.render(d.year,d.month,d.hour,d.minute)+'<div class="footer">'+N(this,d.hour)+C(this,d.minute)+"</div></div>"}this.el.innerHTML=r,this.el.querySelector(".footer").appendChild(this.nowButton()),t.bound&&"hidden"!==t.field.type&&n(function(){t.trigger.focus()},1),"function"==typeof this._o.onDraw&&n(function(){l._o.onDraw.call(l)},0)}},adjustPosition:function(){var e=this._o.trigger,t=e.getBoundingClientRect(),n=t.left-t.width/2-e.offsetWidth,a=t.bottom-t.height-e.offsetHeight;this.el.style.left=n+"px",this.el.style.top=a+"px"},isToday:function(e,t){return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),e.getTime()===t.getTime()},render:function(e,t,n,a){var i=this._o,s=new Date,o=m(e,t),r=new Date(e,t,1).getDay(),l=[],u=[];i.firstDay>0&&(r-=i.firstDay,0>r&&(r+=7));for(var d=o+r,h=d;h>7;)h-=7;d+=7-h;for(var c=0,g=0;d>c;c++){var y=new Date(e,t,1+(c-r),n,a),D=f(this._d)?v(y,this._d):!1,b=this.isToday(y,s),_=r>c||c>=o+r,R=i.startRange&&v(i.startRange,y),x=i.endRange&&v(i.endRange,y),N=i.startRange&&i.endRange&&i.startRange<y&&y<i.endRange,C=i.minDate&&y<i.minDate||i.maxDate&&y>i.maxDate||i.disableWeekends&&p(y)||i.disableDayFn&&i.disableDayFn(y),T={day:1+(c-r),month:t,year:e,isSelected:D,isToday:b,isDisabled:C,isEmpty:_,isStartRange:R,isEndRange:x,isInRange:N};u.push(w(T)),7===++g&&(i.showWeekNumber&&u.unshift(M(c-r,t,e)),l.push(k(u,i.isRTL)),u=[],g=0)}return E(i,l)},show:function(){this.el.hidden=!1,this._v||(h(this.el,"is-hidden"),this._v=!0,this.draw(),this._o.bound&&(s(t,"click",this._onClick),this.adjustPosition()),"function"==typeof this._o.onOpen&&this._o.onOpen.call(this))},hide:function(){this._v!==!1&&(this._o.bound&&o(t,"click",this._onClick),d(this.el,"is-hidden"),this._v=!1,"function"==typeof this._o.onClose&&this._o.onClose.call(this))},hideElem:function(e){e.hidden=!0},destroy:function(){this.hide(),o(this.el,"mousedown",this._onMouseDown,!0),o(this.el,"change",this._onChange),this._o.field&&(o(this._o.field,"change",this._onInputChange),this._o.bound&&(o(this._o.trigger,"click",this._onInputClick),o(this._o.trigger,"focus",this._onInputFocus),o(this._o.trigger,"blur",this._onInputBlur))),this.el.parentNode&&this.el.parentNode.removeChild(this.el)}},B.toFormatDate=function(e){if(!(e instanceof Date))throw"date is not a Date";if(isNaN(e.getDate()))throw"date is NaN";var t=e.getDate();t=10>t?"0"+t:t;var n=e.getMonth()+1;n=10>n?"0"+n:n;var a=e.getFullYear(),i=e.getHours();i=10>i?"0"+i:i;var s=e.getMinutes();return s=10>s?"0"+s:s,t+"."+n+"."+a+" "+i+":"+s},B.convertStringToDate=function(e){var t=e.slice(0,2)-0,n=e.slice(3,5)-1,a=e.slice(6,10)-0,i=e.slice(11,13)-0,s=e.slice(14,16)-0;return new Date(a,n,t,i,s)},e.Pikaday=B,B}(window,window.document,window.setTimeout);</script>

<dom-module id="paper-pikaday">

  <style>
    :host {
      display: inline;
      padding: 1rem 0 0 0;
      position: relative;
      margin-right: 1rem;
      z-index: 0;
      width: 100%;
      height: 100%;
      vertical-align: middle;
      white-space: nowrap;
    }

    input::-webkit-input-placeholder {
      line-height: inherit;
      color: rgba(136, 131, 131, 0.5);
      font-family: DroidSansMono, monospace;
      font-size: inherit;
    }

    input {
      position: absolute;
      font-family: DroidSansMono, monospace;
      font-size: 17px;
      padding: 0;
      margin: 0;
      left: 0;
      outline: none;
      background-color: transparent;
      text-indent: 4px;
      border: none;
      height: auto;
      width: 100%;
      color: rgb(66, 69, 64);
      transition: box-shadow 0.5s ease;
    }

    input[is="iron-input"]:focus {
      border: none;
    }

    input[is="iron-input"] {
      z-index: 2;
    }

    input[disabled] {
      border: none;
      pointer-events: none;
      z-index: 1;
    }

    .label-container,
    .input-container {
      display: inline-block;
      vertical-align: text-top;
    }

    .label-container {
      border: 1px solid transparent;
      box-sizing: border-box;
    }

    .input-container {
      position: relative;
      width: 170px;
    }
  </style>

  <template>

    <div class="label-container">
      <label for$="{{id}}">[[label]]</label>
    </div>

    <div class="input-container">
      <input id$="{{id}}"
             disabled$="[[disabled]]"
             type="text">
      <input type="text"
             disabled
             id="inputMask">
    </div>

  </template>

  <script>"use strict";!function(t){var e=t.Pikaday,a=t.VMasker;new Polymer({is:"paper-pikaday",_maskPattern:"99.99.9999 99:99",_placeholder:"ДД.ММ.ГГГГ чч:мм",_field:null,_vMasker:null,_pikaday:null,properties:{id:String,from:String,until:String,date:Date},get field(){return this._field},onSelect:function(t){this.date=t,this._field.value=e.toFormatDate(t)},showDatePicker:function(){this._pikaday.show()},_setPlaceholder:function(t){var e=this.$.inputMask;t.maxLength=e.maxLength=this._maskPattern.length;for(var a="",n=0;n<e.maxLength;n++){var i=this._maskPattern[n];a+=i.search(/\D/)?" ":i}t.placeholder=this._placeholder,e.placeholder=a},_getDefaultDates:function(){var t=new Date(0);this.from&&(t=new Date(this.from));var e=new Date;return this.until&&(e=new Date(this.until)),{minDate:t,maxDate:e}},_loadPikaday:function(t){var a=this._getDefaultDates(),n=a.minDate,i=a.maxDate;try{return new e({field:t,showWeekNumber:!0,firstDay:1,numberOfMonths:1,minDate:n,maxDate:i,yearRange:[n.getFullYear(),i.getFullYear()],container:this.parentElement,onSelect:this.onSelect.bind(this)})}catch(r){return null}},_loadVMasker:function(t){try{return new a(t).maskPattern(this._maskPattern)}catch(e){return null}},ready:function(){var t=this._field=this.$$("#"+this.id);this._setPlaceholder(t),this._pikaday=this._loadPikaday(t),this._vMasker=this._loadVMasker(t)}})}(window);</script>

</dom-module>
